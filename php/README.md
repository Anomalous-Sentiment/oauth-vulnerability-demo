# Service Provider App
This folder contains the code and files needed to run the Service provider app to issue OAUTH v1.0a tokens

## Available accounts
- Consumer Developer Account
    - Username ```devclient```
    - Password ```devpass```
- Victim Account
    - Username ```victim```
    - Password ```victimpass```

## Available Routes
- [http://localhost:8100](http://localhost:8100)
    - The home page of the service provider app can be found here
    - Will be redirected automatically to the login page for now
- [http://localhost:8100/login](http://localhost:8100/login)
    - The login page of the service provider. Once a user has logged in through this page, the user will be able to access apps created for the consumer to have access to the service provider's resources.
- [http://localhost:8100/dashboard](http://localhost:8100/dashboard)
    - The resources page of the service provider app can be found here. This page will show all applications user has created to allow client consumer access to their service provider's resources. The user must be logged in to access this page.
    - The user can retrieve the consumer key here to give to the client consumer.
- [http://localhost:8100/dashboard/create](http://localhost:8100/dashboard/create)
    - The OAUTH application creation page for generating the ```oauth_consumer_key``` to forumate in the request token URL for the consumer.
    - The user must be logged in to access this page
- [http://localhost:8100/oauth/request_token](http://localhost:8100/oauth/request_token)
    - The first step into obtaining authorization for the client consumer is to get a Request Token and Token Secret using the ```oauth_consumer_key``` upon creation of the app and a ```oauth_callback``` URL.
    - The following is an example URL request token
    ```
    http://localhost:8100/oauth/request_token
    ?oauth_consumer_key=bb4a63e74af1197811a9a51afa056113
    &oauth_callback=http://localhost:4000/oauth/callback
    ```

    - The service provider returns a response of the Authentication Token and a callback confirmed
    ```
    {"oauth_token":"42602564021893281-4f6e3ef74b14770c",
    "oauth_token_secret":"f9d4e04343b44826",
    "oauth_callback":"confirmed"}
    ```
    - If no callback URL is specified as required by OAUTH v1.0a then the following response is given
    ```
    {"oauth_problem":"oauth_parameter_absent",
    "oauth_parameter_absent":"oauth_callback"}
    ```
- [http://localhost:8100/oauth/authorize](http://localhost:8100/oauth/authorize)
    - After getting the Request Token, the second step is the consumer client needs to present the service provider's authorization page to the user with the Authentication Token. From which they will be asked to login using their service provider's account and grant permission access to the application
    - After the authorization is complete the service provider will redirect the user back to the callback url given during the Request Token stage with the authentication ```oauth_token``` and ```oauth_verifier```

    - The following is an example authorization URL
    ```
    http://localhost:8100/oauth/authorize
    ?oauth_token=42602564021893281-4f6e3ef74b14770c
    ```
    - The user will be redirected to the login page if they aren't signed in yet
    ```
    http://localhost:8100/login?redir=//localhost:8100/oauth/authorize?oauth_token=42602564021893281-4f6e3ef74b14770c
    ```
    - The user will then return back to the authorization URL which confirms whether they want to grant authorization
    - After that, the user's account will be added to the applications authorization list and will be redirected back to the callback URL with the ```oauth_verifier```
    - The following is an example callback URL returned back to the consumer
    ```
    http://localhost:4000/oauth/callback
    ?oauth_token=42602564021893281-4f6e3ef74b14770c
    &oauth_verifier=014fffce99b71ac5
    ```

- [http://localhost:8100/oauth/access_token](http://localhost:8100/oauth/access_token)
    - After the user has authorised their service provider's account to your consumer application, you can exchange the Request Token for an Access Token. This access token should be stored by the consumer client application in order to make authorised requests to the service provider and access protected resources
    - The following is an example for requesting an Access Token, now requiring the ```oauth_verifier```
    ```
    http://localhost:8100/oauth/access_token
    ?oauth_consumer_key=bb4a63e74af1197811a9a51afa056113
    &oauth_token=42602564021893281-4f6e3ef74b14770c
    &oauth_verifier=014fffce99b71ac5
    ```
    - The service provider will respond with the following Access Token
    ```
    {"username":"victim",
    "oauth_token":"29232208269424240-a194fdcb99eb0909",
    "oauth_token_secret":"48299010af48ab07"}
- [http://localhost:8100/api/user_data](http://localhost:8100/api/user_data)
    - Finally, the consumer application can use the Access Token to gain access to the user that has authorised their account on the application with the relavent tokens
    - The following is an example for requesting the user's data with the Access Token
    ```
    http://localhost:8100/api/user_data
    ?oauth_consumer_key=bb4a63e74af1197811a9a51afa056113
    &oauth_token=29232208269424240-a194fdcb99eb0909
    ```
    - The service provider will respond with the following protected resources of the user
    ```
    {"username":"victim","stat":"ok"}
    ```
- [http://localhost:8100/api/deauth](http://localhost:8100/api/deauth)
    - Simple API to deauthorise the user's service provider account to the consumer client.
    - This will remove the access token and the authentication token from the database
    - The following is an example for unlinking their account to the consumer
    ```
    http://localhost:8100/api/deauth
    ?oauth_consumer_key=bb4a63e74af1197811a9a51afa056113
    &oauth_token=29232208269424240-a194fdcb99eb0909
    ```
    - The service provider will respond with the following to confirm successful deauthorisation
    ```
    {"stat":"ok"}
    ```