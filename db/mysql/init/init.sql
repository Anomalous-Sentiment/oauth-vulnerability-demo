CREATE DATABASE IF NOT EXISTS dev;
USE dev;

CREATE TABLE IF NOT EXISTS accounts (
	username VARCHAR(25) PRIMARY KEY,
	password VARCHAR(25) NOT NULL
);

CREATE TABLE IF NOT EXISTS apps (
	id SMALLINT(6) AUTO_INCREMENT PRIMARY KEY,
	name VARCHAR(25) NOT NULL,
	username VARCHAR(25) NOT NULL,
	oauth_consumer_key CHAR(32),
	CONSTRAINT FK_username
		FOREIGN KEY (username)
		REFERENCES accounts (username),
	CONSTRAINT UC_oauth_consumer_key UNIQUE (oauth_consumer_key)
);

CREATE TABLE IF NOT EXISTS authlist(
	id SMALLINT(6) NOT NULL,
	username VARCHAR(25),
	oauth_token CHAR(34) PRIMARY KEY,
	oauth_token_secret CHAR(16),
	oauth_callback VARCHAR(150) NOT NULL,
	oauth_verifier CHAR(16),
	CONSTRAINT FK_auth_appid
		FOREIGN KEY (id)
		REFERENCES apps (id),
	CONSTRAINT FK_auth_username
		FOREIGN KEY (username)
		REFERENCES accounts (username)
);

CREATE TABLE IF NOT EXISTS accesslist(
	oauth_token CHAR(34) NOT NULL,
	oauth_access_token CHAR(34) PRIMARY KEY,
	oauth_access_token_secret CHAR(16),
	CONSTRAINT FK_auth_token
		FOREIGN KEY (oauth_token)
		REFERENCES authlist (oauth_token)
);

INSERT INTO accounts VALUES ('devclient', 'devpass');
INSERT INTO accounts VALUES ('victim', 'victimpass');

INSERT INTO apps (name, username, oauth_consumer_key) VALUES ('My Consumer App', 'devclient', '59a2980d36017a5830047fd5d0e7f982');