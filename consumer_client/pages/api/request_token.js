import { withSessionRoute } from "../../lib/withSession";
import prisma from '../../lib/prisma.ts';

export default withSessionRoute(RequestTokenRoute);

async function RequestTokenRoute(req, res)
{
    //Get request token from service provider. Docker service name is used as it is inter-docker container communication
    const url = new URL('http://web:80/oauth/request_token');
    url.searchParams.append('oauth_consumer_key', '59a2980d36017a5830047fd5d0e7f982');
    

    const redirectUrl = await fetch(url)
    .then(res => res.json())
    .then(json => {
      console.log(json)
      const reqToken = json['oauth_token'];
      const tokenSecret = json['oauth_token_secret'];

      //Service provider url here is the exposed port on host, as it is not inter-docker container communication
      const authUrl = new URL('http://localhost:8100/oauth/authorize');
      authUrl.searchParams.append('oauth_token', reqToken);
      authUrl.searchParams.append('oauth_callback', 'http://localhost:4000/oauth/callback');

      return authUrl;
    })


    res.send({redirectUrl})
}