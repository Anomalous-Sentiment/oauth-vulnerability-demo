import { withSessionRoute } from "../../lib/withSession";
import prisma from '../../lib/prisma.ts';

export default withSessionRoute(loginRoute);

async function loginRoute(req, res) {

  const body = JSON.parse(req.body);

  //Search database for matching username and password
  const matchingUsers = await prisma.user.findMany({
    where: { username: body.username, password: body.password },
  });

  req.session.user = {
    username: body.username,
    loggedIn: true
  };

  await req.session.save();

  //Return json object with two values. One for whether login was successful, and one for the username
  res.send({loggedIn: true, username: req.session.user.username});
}