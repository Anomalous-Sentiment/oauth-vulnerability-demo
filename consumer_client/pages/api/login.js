import { withSessionRoute } from "../../lib/withSession";
import prisma from '../../lib/prisma.ts';

export default withSessionRoute(loginRoute);

async function loginRoute(req, res) {

  const body = JSON.parse(req.body);
  var success = false;

  //Search database for matching username
  const matchingUser = await prisma.user.findUnique({
    where: { username: body.username },
  });

  if (matchingUser != null && matchingUser['password'] === body['password'])
  {
    //Set the user session
    req.session.user = {
      username: body.username,
      loggedIn: true
    };
    success = true;
  }
  else
  {
    // Do not set session
    req.session.user = null;
    success = false;
  }

  await req.session.save();

  //Return json object with boolean to indicate success
  res.send({loggedIn: success});
}