import { withSessionRoute } from "../../lib/withSession";
import prisma from '../../lib/prisma.ts';

export default withSessionRoute(registerRoute);

async function registerRoute(req, res) {

  const body = JSON.parse(req.body);
  var success = false;

  //Check if username exists in db already
  const matchingUser = await prisma.user.findUnique({
    where: { username: body.username },
  });

  
  if (!matchingUser)
  {
    //Insert into database if user does not exist
    const user = await prisma.user.create({
      data: { username: body.username, password: body.password },
    })

    success = true;
  }
  else
  {
    success = false;
  }

  //Return json object with value to indicate whether operation was successsful
  res.send({success: success});
}