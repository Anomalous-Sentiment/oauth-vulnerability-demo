import styles from '../styles/Home.module.css'
import Form from 'react-bootstrap/Form';
import Link from 'next/link'
import Button from 'react-bootstrap/Button';
import { useState } from 'react';
import { useRouter } from 'next/router'
import Alert from 'react-bootstrap/Alert';
import 'bootstrap/dist/css/bootstrap.min.css';

export default function Register() {
  const router = useRouter();
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [password2, setPassword2] = useState('');
  const [showError, setShow] = useState(false)
  const [errrorMsg, setMsg] = useState('')

  function handleRegister()
  {
    const body = {'username' : username, 'password': password}

    //Check if both passwords are the same
    if (password === password2)
    {
      fetch('api/login', {
        method: 'Post',
        body: JSON.stringify(body)
      })
      .then(res => {
        return res.json()
      })
      .then((json) => {
        //Check if succcessful register
        if (json['success'])
        {
          //If successful, redirect to login page
          router.push('/login')
        }
        else
        {
          setMsg('Error. Username already exists.');
          setShow(true)
        }
      })
    }
    else
    {
      //Show error message
      setMsg('Error. Passwords are not equal.');
      setShow(true);
    }
  }


  return (
    <div className={styles.container}>
      <div className={styles.loginBox}>
        <h1>Login</h1>
        <Form.Label htmlFor="usernameInput">Username</Form.Label>
        <Form.Control
            type="text"
            id="usernameInput"
            value={username}
            onChange={(event) => setUsername(event.target.value)}
        />
        <Form.Label htmlFor="passwordInput">Password</Form.Label>
        <Form.Control
            type="password"
            id="passwordInput"
            value={password}
            onChange={(event) => setPassword(event.target.value)}
        />
        <Form.Label htmlFor="passwordInput2">Repeat Password</Form.Label>
        <Form.Control
            type="password"
            id="passwordInput2"
            value={password}
            onChange={(event) => setPassword2(event.target.value)}
        />
        <Button
        onClick={handleRegister}>
          Register
        </Button>
        <Link href='/login'>
          <a>Or login</a>
        </Link>
        {showError &&
          <Alert variant='danger'>
          {errrorMsg}
          </Alert>
        }

      </div>
    </div>
  )
}
